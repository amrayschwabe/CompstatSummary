\section{Model Selection}
\textbf{Criteria: } Mallow's $C_p$, AIC, BIC = $2-ln(\hat L) + d*log(n)$, Adjusted $R^2$
\textbf{Ridge regression: } $\hat\beta^{ridge} = argmin ||y-XB||_2^2+ \lambda||B||_2^2$. If you draw that, circle around zero. 
\begin{lstlisting}[language=R]
data(Hitters)
Hitters=na.omit(Hitters)
x = model.matrix(Salary~.,  data=Hitters)
x = x[,-1] #remove first column (intercept)
y = Hitters$Salary
grid=10^seq(from = 10, to = -2, length=100)
ridge.mod = glmnet(x,y,alpha=0,lambda=grid)
\end{lstlisting}
\textbf{Lasso regression: }
$\hat\beta^{lasso} = argmin ||y-XB||_2^2+ \lambda||B||_1^2$. If you draw that, diamond around zero -> will set values to zero. 
\begin{lstlisting}[language=R]
lasso.mod = glmnet(x[train,], y[train], alpha=1, 
                   lambda=grid, thresh=1e-12)
\end{lstlisting}
\textbf{Best subset: }
1)$M_0$ null model (only sample mean)
2) fit $p \choose k$ models with k pred. and select best $M_k$
3) select best among $M_0 ... M_p$
\begin{lstlisting}[language=R]
regfit.full=regsubsets(Salary~., data=Hitters,nvmax=19)
\end{lstlisting}

\textbf{Forward stepwise: }
1)$M_0$ null model (only sample mean)
2) fit p-k models that add 1 pred and select best $M_k$
3) select best among $M_0 ... M_p$
\begin{lstlisting}[language=R]
regfit.fwd=regsubsets(Salary~., data=Hitters,nvmax=19,method="forward")
\end{lstlisting}
\textbf{Backward stepwise: }
1) $M_p$ full model
2) k = p, p-1, ...1,
k models with 1 pred less, choose best $M_{k-1}$
3) select best $M_0 ... M_p$
\begin{lstlisting}[language=R]
regfit.bwd=regsubsets(Salary~., data=Hitters,nvmax=19,method="backward")
\end{lstlisting}
\textbf{Choose amongst models: }
\begin{lstlisting}[language=R]
train=sample (c(TRUE,FALSE), nrow(Hitters),replace=TRUE)
test=(!train)
regfit.best = regsubsets(Salary~., data=Hitters[train,],nvmax=19)
#compute mean squared error on test set}
test.mat = model.matrix(Salary~., data=Hitters[test,])
val.errors = rep(NA,19)
for(i in 1:19){
  coefi = coef(regfit.best,id=i)
  pred = test.mat[,names(coefi)]%*%coefi
  val.errors[i] = mean((Hitters$Salary[test]-pred)^2)
}
 #refit model with 10 variables on full data to obtain our final best model
regfit.best=regsubsets(Salary~., data=Hitters,nvmax=19)
coef(regfit.best, which.min(val.errors))
\end{lstlisting}